-- Contortionist database schema

-- Schema version
CREATE TABLE IF NOT EXISTS `meta` ( `schema` TEXT UNIQUE, `version` INTEGER, PRIMARY KEY(`schema`) );
INSERT OR REPLACE INTO meta (schema, version) VALUES ('contortionist', 1);

CREATE TABLE IF NOT EXISTS `messages` ( `id` INTEGER PRIMARY KEY AUTOINCREMENT,
                                        `message` TEXT, `status` INTEGER NOT NULL DEFAULT 1 );

CREATE TABLE IF NOT EXISTS `jobs` ( `id` INTEGER PRIMARY KEY AUTOINCREMENT,
                                    `message_id` INTEGER NOT NULL,
                                    `status` INTEGER DEFAULT 1,
                                     FOREIGN KEY (`message_id`) REFERENCES `message(id)` );

CREATE TABLE IF NOT EXISTS `tasks` ( `id` INTEGER PRIMARY KEY AUTOINCREMENT,
                                     `job_id` INTEGER NOT NULL,
                                     `name` TEXT NOT NULL,
                                     `status` INTEGER DEFAULT 1,
                                     `priority` INTEGER NOT NULL,
                                      FOREIGN KEY (`job_id`) REFERENCES `jobs(id)` );
